//! point.js v 0.2
//! url: https://pointjs.org
((point,document)=>{const isArray=a=>"[object Array]"===Object.prototype.toString.call(a);point.ready=a=>{const b=document.removeEventListener||document.detachEvent,c=document.addEventListener?"DOMContentLoaded":"onreadystatechange",d=document.addEventListener||document.attachEvent;-1===["complete","loaded","interactive"].indexOf(document.readyState)?d.call(document,c,function(d){b(c,arguments.callee,!1),a(d)},!1):a(document,event)},point.ready(()=>{document.head.insertAdjacentHTML("beforeend","<style> [point-component] { display: none; } </style>")});const returnPromise=a=>new Promise((b,c)=>{setTimeout(()=>{(a?c:b)({error:a})},5)}),ext_modifiers={};point.modifier=(a,b)=>{ext_modifiers[a]=b};const get_contitions=a=>{let b,c,d=[];const e=/\{\{if(.*?)\}\}(.*?)\{\{\/if\}\}/gms,f=/\{\{if (.*?)\}\}/gm;for(;null!==(b=e.exec(a));)for(b.index===e.lastIndex&&e.lastIndex++;null!==(c=f.exec(b[0]));){c.index===f.lastIndex&&f.lastIndex++;let a=b[2].split("{{if:else}}");d.push([b[0],c[0],a[0],1<a.length?a[1]:""])}return d},run_modifiers=(a,b)=>{if(" "===a||""===a||a===void 0||null===a||"null"===a)return"no_null"===b[0]?"-":"hidden_if_empty"===b[0]?"hidden":"";if(!b||0==b.length)return a;a=a.toString();for(let c=0;c<b.length;c++){const d=b[c].toLowerCase();if("capitalize"===d&&(a=a.toLowerCase().replace(/^.|\s\S/g,b=>b.toUpperCase())),"uppercase"===d&&(a=a.toUpperCase()),"lowercase"===d&&(a=a.toLowerCase()),"nl2br"===d&&(a=a.replace(/(\r\n|\n|\r)/gm,"<br>")),"nozero"===d&&"0"===a.toString()&&(a=""),"clean_url"===d&&(a=a.split("://"),a=2===a.length?a[1]:a[0],a=a.replace("www.",""),"/"==a.slice(-1)&&(a=a.substring(0,a.length-1))),"unix2date"===d&&(a=new Date(1e3*a)),"format_number"===d&&(a=format_number(a,2).replace(".00","")),"format_decimal"===d&&(a=format_number(a,2)),"format_number_as_word"===d&&(a=format_number_as_word(a)),"format_int"===d&&(a=format_number(a,0)),"format_percent"===d&&(a=format_number(100*a,2)+"%"),"checked"===d&&(!0==a||"true"==a||1==a||"1"==a)&&(a=" checked"),"negative_checked"===d&&(!1==a||"false"==a||-1==a||"-1"==a)&&(a=" checked"),"selected"===d&&(!0==a||"true"==a||1==a||"1"==a)&&(a=" selected"),"negative_selected"===d&&(!1==a||"false"==a||-1==a||"-1"==a)&&(a=" selected"),"link"===d){let b,c,d,e;c=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,b=a.replace(c,"<a href=\"$1\" target=\"_blank\">$1</a>"),d=/(^|[^\/])(www\.[\S]+(\b|$))/gim,b=b.replace(d,"$1<a href=\"http://$2\" target=\"_blank\">$2</a>"),e=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,b=b.replace(e,"<a href=\"mailto:$1\">$1</a>"),a=b}ext_modifiers.hasOwnProperty(d)&&(a=ext_modifiers[d](a))}return a},single=(template,data)=>{const conditions=get_contitions(template);for(let i=0;i<conditions.length;i++){let cond,statement=conditions[i][0],condition=conditions[i][1],match=conditions[i][2],nomatch=conditions[i][3];for(const regex=/if (\w+)[\s+](\!=|<>|>=|<=|=+)[\s+]/gm;null!==(cond=regex.exec(condition));){cond.index===regex.lastIndex&&regex.lastIndex++;let word=cond[1],new_cond=process(condition.replace(word,"\"{{"+word+"}}\""),data);new_cond=new_cond.replace(" == true"," == \"true\"").replace(" == false"," == \"false\"");let matched=eval(new_cond.replace("{{if ","(").replace("}}",")"));template=template.replace(statement,matched?match:nomatch)}}return process(template,data)},process=(a,b)=>a.replace(/\{\{([\w\|\.\(\)]*)\}\}/g,(a,c)=>{const d=c.split("|")[0],e=c.split("|").splice(1),f=d.split(".");let g=b[f.shift()];for(let b=0,d=f.length;b<d;b++)try{g=g[f[b]]}catch(a){g=""}return g=run_modifiers(g,e),"undefined"!=typeof g&&null!==g?g:""}),loop=(a,b)=>{const c=[];for(let d=0;d<b.length;d++)c.push(single(a,b[d]));return c.join("")};point.loadExternal=(a,b)=>{let c=new XMLHttpRequest;b=b||function(){},c.onreadystatechange=function(){4===c.readyState&&b(c.responseText.trim())},c.open("GET",a),c.send()};const loadHTML=(a,b,c,d)=>{let e,f;document.getElementById(b)?(f="element",b=document.getElementById(b)):document.querySelectorAll(`*[point-component=${b}]`)[0]&&(f="component",b=document.querySelectorAll(`*[point-component=${b}]`)[0]),point.loadExternal(a,a=>(-1===a.indexOf("point-component")?(e=b.id||"tjs"+Date.now(),a=`<div point-component="${e}">${a}</div>`):e=a.split("point-component=")[1].replace(/\'|\"/gm,"").split(" ")[0],b.insertAdjacentHTML("beforebegin",a),!1==d?point.render(e,c,!1):point.attach(e,c,!1)))},loadJSON=(a,b,c)=>{point.loadExternal(a,d=>(a=JSON.parse(d),b?!1==c?point.render(b,a,!1):point.attach(b,a,!1):a))},loadRemote=(a,b,c,d)=>{point.loadExternal(b,b=>loadHTML(a,c,JSON.parse(b),d))};point.attachHTML=(a,b,c)=>loadHTML(a,b,c,!0),point.renderHTML=(a,b,c)=>loadHTML(a,b,c,!1),point.attachJSON=(a,b)=>{let c=loadJSON(a,b,!0);return returnPromise(c)},point.renderJSON=(a,b)=>{let c=loadJSON(a,b,!1);return returnPromise(c)},point.attachRemote=(a,b,c,d)=>{let e=loadRemote(a,b,c,d,!0);return returnPromise(e)},point.renderRemote=(a,b,c,d)=>{let e=loadRemote(a,b,c,d,!1);return returnPromise(e)},point.render=(a,b,c)=>{let d=!1;try{b=b||{};const c=document.querySelectorAll(`*[point-component=${a}]`)[0];if(!c)return;document.querySelectorAll(`*[point-component=${a}]`)[0].style.display="";const d=document.querySelectorAll(`*[point-rendered=${a}]`);for(let a=0;a<d.length;a++)d[a].parentNode.removeChild(d[a]);let e=c.outerHTML.replace(`point-component='${a}'`,`point-rendered="${a}"`).replace(`point-component="${a}"`,`point-rendered="${a}"`);if(-1!==e.indexOf("point-bind")){c.querySelectorAll("[point-bind]").forEach(a=>{const b=a.getAttribute("point-bind");e=e.replace("{{"+b+"}}","<point for=\""+b+"\">{{"+b+"}}</point>")});let a=/<input(.*?)point-bind="(.*?)"(.*?)>/gmi,b=`<input$1point-bind="$2" value="{{$2}}"$3>`;e=e.replace(a,b),a=/<textarea(.*?)point-bind="(.*?)"(.*?)><textarea>/gmi,b=`<textarea$1point-bind="$2"$3>{{$2}}</textarea>`,e=e.replace(a,b)}let f="";isArray(b)||(b=[b]),f=1>=b.length?single(e,b[0]):loop(e,b),c.insertAdjacentHTML("beforebegin",f);const g=document.querySelectorAll("*[data-toggle=\"tooltip\"]");for(let a=0;a<g.length;a++)g[a].tooltip();try{prettySelect.renderLinks()}catch(a){}document.querySelectorAll(`*[point-component=${a}]`)[0].style.display="none"}catch(a){d=a}const e=document.querySelector(`[point-rendered="${a}"]`),f=e.querySelectorAll("[point-bind]");return f.forEach(b=>{const c=b.getAttribute("point-bind");point.$[a][c]&&(b.addEventListener("keyup",()=>{setTimeout(()=>{e.querySelectorAll(`point[for=${c}]`).forEach(a=>{a.innerHTML=b.value})},10)}),b.addEventListener("blur",()=>{point.$[a][c]=b.value}))}),!1===c?d:returnPromise(d)},point.$={},point.attach=(a,b)=>{point.$[a]=b;const c=a=>"object"==typeof a&&isArray(a)?a.filter(()=>!0):a,d=e=>{const f=e=>{"add"==e[0].type?(b=c(e[0]),d(b[b.length-1])):"delete"==e[0].type?(b=c(e[0]),Object.unobserve(e[0].oldValue,f)):b=c(b),point.render(a,b,!1)};for(var g in e)item=e[g],"object"==typeof item&&null!==item&&d(item);Object.observe(e,f)};let e=point.render(a,b,!1);return d(b),returnPromise(e)};const format_number=(a,b)=>{a=parseFloat(a),b=b===void 0?2:b,a=a.toFixed(b)+"",x=a.split("."),x1=x[0],x2=1<x.length?"."+x[1]:"";for(const c=/(\d+)(\d{3})/;c.test(x1);)x1=x1.replace(c,"$1,$2");return x1+x2},format_number_as_word=a=>1e9<=a?(a/1e9).toFixed(1).replace(/\.0$/,"")+"B":1e6<=a?(a/1e6).toFixed(1).replace(/\.0$/,"")+"M":1e3<=a?(a/1e3).toFixed(1).replace(/\.0$/,"")+"K":a})(window.point=window.point||{},document),Object.observe||function(a,b,c,d){"use strict";let e,f,g=["add","update","delete","reconfigure","setPrototype","preventExtensions"];const h=a=>"[object Array]"===Object.prototype.toString.call(a),k=b.indexOf||function(a,b,c){for(var d=c||0;d<a.length;d++)if(a[d]===b)return d;return-1};var l=c.Map!==d&&Map.prototype.forEach?function(){return new Map}:function(){var a=[],b=[];return{size:0,has:function(b){return-1<k(a,b)},get:function(c){return b[k(a,c)]},set:function(c,d){var e=k(a,c);-1===e?(a.push(c),b.push(d),this.size++):b[e]=d},delete:function(c){var d=k(a,c);-1<d&&(a.splice(d,1),b.splice(d,1),this.size--)},forEach:function(c){for(var d=0;d<a.length;d++)c.call(arguments[1],b[d],a[d],this)}}},m=a.getOwnPropertyNames?function(){var b=a.getOwnPropertyNames;try{return arguments.callee}catch(d){var c=(b(k).join(" ")+" ").replace(/prototype |length |name /g,"").slice(0,-1).split(" ");c.length&&(b=function(b){var d=a.getOwnPropertyNames(b);if("function"==typeof b)for(var e,f=0;f<c.length;)-1<(e=k(d,c[f++]))&&d.splice(e,1);return d})}return b}():function(b){var c,d,e=[];if("hasOwnProperty"in b)for(c in b)b.hasOwnProperty(c)&&e.push(c);else for(c in d=a.hasOwnProperty,b)d.call(b,c)&&e.push(c);return h(b)&&e.push("length"),e},n=c.requestAnimationFrame||c.webkitRequestAnimationFrame||function(){var a=+new Date,b=a;return function(c){return setTimeout(function(){c((b=+new Date)-a)},17)}}(),o=function(a,b,c){var d=e.get(a);d?(q(d,a),u(a,d,b,c)):(d=p(a),u(a,d,b,c),1===e.size&&n(r))},p=function(a,b){var c=m(a),d=[],f=0;for(b={handlers:l(),properties:c,values:d,notifier:t(a,b)};f<c.length;)d[f]=a[c[f++]];return e.set(a,b),b},q=function(a,b,c){if(a.handlers.size){var d,e,f,g,h,j,l,n=a.values,o=0;for(d=a.properties.slice(),e=d.length,f=m(b);o<f.length;)h=f[o++],g=k(d,h),j=b[h],-1===g?(v(b,a,{name:h,type:"add",object:b},c),a.properties.push(h),n.push(j)):(l=n[g],d[g]=null,e--,(l===j?0===l&&1/l!=1/j:l===l||j===j)&&(v(b,a,{name:h,type:"update",object:b,oldValue:l},c),a.values[g]=j));for(o=d.length;e&&o--;)null!==d[o]&&(v(b,a,{name:d[o],type:"delete",object:b,oldValue:n[o]},c),a.properties.splice(o,1),a.values.splice(o,1),e--)}},r=function(){e.size&&(e.forEach(q),f.forEach(s),n(r))},s=function(a,b){var c=a.changeRecords;c.length&&(a.changeRecords=[],b(c))},t=function(a,b){return 2>arguments.length&&(b=e.get(a)),b&&b.notifier||{notify:function(b){b.type;var c=e.get(a);if(c){var d,f={object:a};for(d in b)"object"!==d&&(f[d]=b[d]);v(a,c,f)}},performChange:function(b,c){if("string"!=typeof b)throw new TypeError("Invalid non-string changeType");if("function"!=typeof c)throw new TypeError("Cannot perform non-function");var f,g,h=e.get(a),i=arguments[2],j=i===d?c():c.call(i);if(h&&q(h,a,b),h&&j&&"object"==typeof j){for(f in g={object:a,type:b},j)"object"!==f&&"type"!==f&&(g[f]=j[f]);v(a,h,g)}}}},u=function(a,b,c,d){var e=f.get(c);e||f.set(c,e={observed:l(),changeRecords:[]}),e.observed.set(a,{acceptList:d.slice(),data:b}),b.handlers.set(c,e)},v=function(a,b,c,d){b.handlers.forEach(function(b){var e=b.observed.get(a).acceptList;("string"!=typeof d||-1===k(e,d))&&-1<k(e,c.type)&&b.changeRecords.push(c)})};e=l(),f=l(),a.observe=(b,c,e)=>{if(!b||"object"!=typeof b&&"function"!=typeof b)throw new TypeError("Object.observe cannot observe non-object");if("function"!=typeof c)throw new TypeError("Object.observe cannot deliver to non-function");if(a.isFrozen&&a.isFrozen(c))throw new TypeError("Object.observe cannot deliver to a frozen function object");if(e===d)e=g;else if(!e||"object"!=typeof e)throw new TypeError("Third argument to Object.observe must be an array of strings.");return o(b,c,e),b},a.unobserve=(a,b)=>{if(null===a||"object"!=typeof a&&"function"!=typeof a)throw new TypeError("Object.unobserve cannot unobserve non-object");if("function"!=typeof b)throw new TypeError("Object.unobserve cannot deliver to non-function");var c,d=f.get(b);return d&&(c=d.observed.get(a))&&(d.observed.forEach(function(a,b){q(a.data,b)}),n(function(){s(d,b)}),1===d.observed.size&&d.observed.has(a)?f["delete"](b):d.observed["delete"](a),1===c.data.handlers.size?e["delete"](a):c.data.handlers["delete"](b)),a}}(Object,Array,this);
